{% extends "auctions/layout.html" %}

{% block title %}
    {{ listing.title }}
{% endblock title %}

{% block main %}
    <p><strong>{{ listing.title }}</strong> - <small>Created: {{ listing.created_on.date }} <br>Seller: {{ listing.seller }}</small></p>
    {% if not listing.isListingActive %}
        <h3 style="color: red">Listing Closed</h3>
    {% endif %}
    <img src="{{ listing.imageLink }}" alt="Item for sale" style="max-width: 600px">
    <p>{{ listing.description | linebreaks }}</p>
    <p>Current bid: ${{ listing.bidPrice }}</p>
    <small>
        Category:
        <a href="{% url 'listings_by_category' listing.category %}">
            {{ listing.category }}
        </a>
    </small>

    {% if user.is_authenticated %}

    <form action="/listing/{{ listing.pk }}/" method="post">
        {% csrf_token %}
        <div>
            {{ bid_form }}
        </div>
        <button type="submit" name="bid_submit" class="btn btn-primary">Submit</button>
    </form>

    <form action="/listing/{{ listing.pk }}/" method="post">
        {% csrf_token %}
        <div>
            {{ comment_form.body }}
        </div>
        <button type="submit" name="comment_submit" class="btn btn-primary">Submit</button>
    </form>

    {% else %}
        <h3>Please <a href="{% url 'login' %}">
            log in
        </a> to comment, bid, or add to watchlist.</h3>
    {% endif %}

    <h4>Comments:</h4>
    {% for comment in comments %}
        <p>
            <small>{{ comment.created_on }}</small> <br>
            <b>{{ comment.author }}</b> wrote:
            {{ comment.body | linebreaks }}
        </p>
    {% endfor %}
{% endblock main %}